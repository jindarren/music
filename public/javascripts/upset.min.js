function plot(){ctx.plot()}function UpSet(){function e(){ctx.tableBodyHeight=renderRows.length*(ctx.cellDistance+4),ctx.rowScale=d3.scale.ordinal().rangeRoundBands([0,ctx.tableBodyHeight],0,0),ctx.rowScale.domain(renderRows.map(function(e){return e.id})),ctx.cellSize=ctx.cellDistance,ctx.xStartSetSizes=ctx.cellWidth*usedSets.length+ctx.majorPadding,ctx.setVisWidth=ctx.expectedValueWidth+ctx.subSetSizeWidth+ctx.majorPadding+ctx.xStartSetSizes,ctx.w=ctx.xStartSetSizes+ctx.subSetSizeWidth+ctx.expectedValueWidth+ctx.majorPadding+50,ctx.intersectionClicked=function(e){var t=Selection.fromSubset(e.data),a=[],r=[],n="",s="",i="",c="",l=0,o=e.data.elementName.split(","),d="normal";if(1==o.length&&"Query"==o[0])d="queryHeader",e.data.elements().forEach(function(e,t){var a=[];e.forEach(function(e){a.push({name:setIdToSet[e.key].elementName,type:setIdToSet[e.key].cluster,state:e.state})}),r.push(a)});else{var u=[];o.forEach(function(e){if(0==e)n="Papers related to none of the selected sets.",u.push({name:null,type:null});else{var t=setIdToSet[e].elementName.split(/\(|\)/g);if(0==l){switch(setIdToSet[e].cluster){case 0:s=t[0].trim()+", ",n="Papers recommended by "+s;break;case 1:i=t[0].trim()+", ",n="Papers bookmarked by "+i;break;case 2:c=t[0].trim()+", ",n="Papers tagged with "+c}1==usedSets.length?(n=n.slice(0,-2),n+="."):n+="but not related to the rest of the selected sets.",l++}else{switch(setIdToSet[e].cluster){case 0:s+=t[0].trim()+", ";break;case 1:i+=t[0].trim()+", ";break;case 2:c+=t[0].trim()+", "}l++}u.push({name:setIdToSet[e].elementName,type:setIdToSet[e].cluster,state:1})}}),o.length>1&&(n="Papers ",""!=s&&(n+="recommended by "+s),""!=i&&(n+="bookmarked by "+i),""!=c&&(n+="tagged with "+c),usedSets.length>o.length?n+="but not related to the rest of the selected sets.":(n=n.slice(0,-2),n+=".")),r.push(u)}t.items.forEach(function(e){a.push(attributes[0].values[e])});var p=new Date;userBehavior.push({type:4,setsCombination:r,group_type:e.type,query_header:d,Items:a,time:(p.getDate()<10?"0":"")+p.getDate()+" @ "+(p.getHours()<10?"0":"")+p.getHours()+":"+(p.getMinutes()<10?"0":"")+p.getMinutes()+":"+(p.getSeconds()<10?"0":"")+p.getSeconds()}),$(EventManager).trigger("user-behavior-added"),selections.addSelection(t,!1),selections.setActive(t),$("#element-view-description").text(n).css("color",selections.getColor(t))},"undefined"!=typeof ctx.svgBody&&(ctx.svgBody.attr("height",ctx.tableBodyHeight),ctx.svgBody.attr("width",ctx.w)),ctx.horizonBarGrays=d3.scale.linear().domain([0,1,2]).range(["#bdbdbd","#888888","#252525"])}function t(){var t=d3.scale.ordinal().domain([0,1]).range(ctx.grays);e(),d3.select("#bodyVis").select("svg").remove(),ctx.svgBody=d3.select("#bodyVis").append("svg").attr("width",ctx.w),ctx.columnBackgroundNode=ctx.svgBody.append("g").attr({"class":"columnBackgroundsGroup"}).attr({}),ctx.gRows=ctx.svgBody.append("g").attr({"class":"gRows"}),ctx.toolTipLayer=ctx.svgBody.append("g").attr({"class":"toolTipLayer"}),d3.select("#headerVis").select("svg").remove(),ctx.svgHeader=d3.select("#headerVis").append("svg").attr("width",ctx.w).attr("height",100+ctx.textHeight+ctx.guildHeaderHeight).attr("id","mysvg"),ctx.guildHeader=ctx.svgHeader.append("g").attr({"class":"guildHeader"}),ctx.guildHeader.append("circle").attr({r:ctx.cellSize/4-2,cy:ctx.cellSize/4,"class":"cell",transform:"translate(20,0)"}).style("fill",t(1)).style("stroke","#636363").attr({"stroke-width":"2pt"}),ctx.guildHeader.append("text").attr({"class":"cellGuild",transform:"translate(30,12)"}).text("Papers recommended by the agent, bookmarked by the user, or tagged with the tag."),ctx.guildHeader.append("circle").attr({r:ctx.cellSize/4-2,cy:ctx.cellSize/4,"class":"cell",transform:"translate(20,20)"}).style("fill",t(0)).style("stroke","#636363").attr({"stroke-width":"2pt"}),ctx.guildHeader.append("text").attr({"class":"cellGuild",transform:"translate(30,32)"}).text("Papers not recommended by the agent, bookmarked by the user, or tagged with the tag."),ctx.guildHeader.append("circle").attr({r:ctx.cellSize/4-2,cy:ctx.cellSize/4,"class":"cell",transform:"translate(20,40)"}).style("fill","#6fadfd").style("stroke","#6fadfd").attr({"stroke-width":"2pt"}),ctx.guildHeader.append("text").attr({"class":"cellGuild",transform:"translate(30,52)"}).text("Papers bookmarked by the current user."),ctx.tableHeaderNode=ctx.svgHeader.append("g").attr({"class":"tableHeader",transform:"translate("+ctx.leftOffset+","+ctx.guildHeaderHeight+")"}),c(),g(),initCallback=[a],h($(window).height(),null),h(null,$(".ui-layout-center").width())}function a(){ctx.svgBody.attr({width:Math.max(ctx.w,400)}),c(),g()}function r(e){e.selectAll("foreignObject").remove();var t=e.append("foreignObject").attr({transform:"translate("+(ctx.leftOffset+ctx.xStartSetSizes)+","+ctx.guildHeaderHeight+")",width:200,height:150}).append("xhtml:body").append("div").attr({id:"sortConfig","class":"configTable"});t.append("div").style("font-weight","bold").text("Sort rows by"),t.append("div").text("number of papers");var a=t.append("div");a.append("input").attr({type:"radio",id:"sortIntersectionSizeAscend",name:"sort"});var r=a.append("label").attr({"for":"sortIntersectionSizeAscend"});r.append("img").attr({src:"./javascripts/images/ascend.png",width:15,height:15}),r.append("text").text("Ascending");var n=t.append("div");n.append("input").attr({type:"radio",id:"sortIntersectionSize",name:"sort"});var s=n.append("label").attr({"for":"sortIntersectionSize"});s.append("img").attr({src:"./javascripts/images/descend.png",width:15,height:15}),s.append("text").text("Descending"),t.append("div").text("number of filled circles");var i=t.append("div");i.append("input").attr({type:"radio",id:"sortNrSetsInIntersectionAscend",name:"sort"});var c=i.append("label").attr({"for":"sortNrSetsInIntersectionAscend"});c.append("img").attr({src:"./javascripts/images/ascend.png",width:15,height:15}),c.append("text").text("Ascending");var l=t.append("div");l.append("input").attr({type:"radio",id:"sortNrSetsInIntersectionDescend",name:"sort"});var o=l.append("label").attr({"for":"sortNrSetsInIntersectionDescend"});o.append("img").attr({src:"./javascripts/images/descend.png",width:15,height:15}),o.append("text").text("Descending"),""!=ctx.sortCheck&&d3.select("#"+ctx.sortCheck).attr("checked","true"),f()}function n(e){var t=d3.scale.ordinal().rangeRoundBands([0,usedSets.length*ctx.cellWidth],0);t.domain(usedSets.map(function(e){return e.id}));var a=e.selectAll(".setRow").data(usedSets,function(e){return e.elementName}),r=a.enter().append("g").attr({"class":"setRow"});a.exit().remove();var n=a.selectAll(".sortHeaderGroup").data(function(e,t){return[e]}),s=n.enter().append("g").attr({"class":"sortHeaderGroup"});s.append("text").text("").attr({"class":"groupDeleteIcon",transform:"translate(10, 15)"}).style("fill","#f46d43").on("click",setClicked).on("mouseover",function(e){document.getElementById("tipbar").innerHTML="Click to remove [ "+e.elementName+" ] from the view."}).on("mouseout",function(e){document.getElementById("tipbar").innerHTML=""}),s.append("rect").attr({transform:function(e,t){return"translate(0,15) skewX(-45)"},"class":"sortBySet connection vertical",width:ctx.cellWidth,height:ctx.textHeight-2}).on("mouseover",function(e,t){var a=e.elementName.split(/\(|\)/g),r="";switch(e.cluster){case 0:r+="recommended by "+a[0].trim();break;case 1:r+="bookmarked by "+a[0].trim();break;case 2:r+="tagged with "+a[0].trim()}document.getElementById("tipbar").innerHTML="Click to view all papers "+r+".",mouseoverColumn(e,t)}).on("mouseout",function(e,t){document.getElementById("tipbar").innerHTML="",mouseoutColumn()}).append("svg:title").text(function(e,t){if(e.id==globalSetId)return"Papers bookmarked by you.";var a=e.elementName.split(/\(|\)|\//g);switch(e.cluster){case 0:return a[1].trim()+" papers recommended by "+a[0].trim()+".";case 1:return parseInt(a[2].trim())>1?a[2].trim()+" papers bookmarked by "+a[0].trim()+".":a[2].trim()+" paper bookmarked by "+a[0].trim()+".";case 2:return parseInt(a[1].trim())>1?a[1].trim()+" papers tagged with "+a[0].trim()+".":a[1].trim()+" paper tagged with "+a[0].trim()+"."}return""}).style({"font-size":"16pt"});var i=(r.selectAll("text").data(function(e){return[e]}),r.append("text"));i.text(function(e){var t=e.elementName.substring(0,ctx.truncateAfter);return t.length<e.elementName.length&&(t=t.trim()+"..."),t}).attr({"class":"setLabel sortBySet noselect",id:function(e){return e.id},transform:"translate("+(-ctx.topOffset+90)+","+(ctx.leftOffset+10)+")rotate(-45)","text-anchor":"start"}).style({cursor:"s-resize"}).on("mouseover",function(e,t){var a=e.elementName.split(/\(|\)/g),r="";switch(e.cluster){case 0:r+="recommended by "+a[0].trim();break;case 1:r+="bookmarked by "+a[0].trim();break;case 2:r+="tagged with "+a[0].trim()}document.getElementById("tipbar").innerHTML="Click to view all papers "+r+".",mouseoverColumn(e,t)}).on("mouseout",function(){document.getElementById("tipbar").innerHTML="",mouseoutColumn()}),i.append("svg:title").text(function(e,t){var a=setIdToSet[e.id].elementName.split(/\(|\)|\//g);switch(e.cluster){case 0:return a[1].trim()+" papers recommended by "+a[0].trim()+".";case 1:return parseInt(a[2].trim())>1?a[2].trim()+" papers bookmarked by "+a[0].trim()+".":a[2].trim()+" paper bookmarked by "+a[0].trim()+".";case 2:return parseInt(a[1].trim())>1?a[1].trim()+" papers tagged with "+a[0].trim()+".":a[1].trim()+" paper tagged with "+a[0].trim()+"."}}).style({"font-size":"16pt"}),n.exit().remove(),a.attr({transform:function(e,a){return"translate("+t(e.id)+", 0)"},"class":"setRow"}),d3.selectAll(".sortBySet, .setRow .setLabel").on("click",function(e,t){var a=new Date;userBehavior.push({type:2,sort:[{name:e.elementName,type:e.cluster}],time:(a.getDate()<10?"0":"")+a.getDate()+" @ "+(a.getHours()<10?"0":"")+a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes()+":"+(a.getSeconds()<10?"0":"")+a.getSeconds()}),UpSetState.sorting=StateOpt.sortBySetItem,UpSetState.forceUpdate=!0,updateState(e),b(),$("#sortIntersectionSize").prop("checked",!1),$("#sortIntersectionSizeAscend").prop("checked",!1),$("#sortNrSetsInIntersectionAscend").prop("checked",!1),$("#sortNrSetsInIntersectionDescend").prop("checked",!1),ctx.sortCheck="";var r=Selection.fromSubset(levelOneGroups[parseInt(t/2)+1]),n=e.id,s=[];r.items.forEach(function(e){s.push(attributes[0].values[e])}),userBehavior.push({type:4,setsCombination:[{name:setIdToSet[n].elementName,type:setIdToSet[n].cluster,state:1}],group_type:e.type,Items:s,time:(a.getDate()<10?"0":"")+a.getDate()+" @ "+(a.getHours()<10?"0":"")+a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes()+":"+(a.getSeconds()<10?"0":"")+a.getSeconds()}),$(EventManager).trigger("user-behavior-added"),selections.addSelection(r,!1),selections.setActive(r);var i=setIdToSet[n].elementName.split(/\(|\)/g),c="";switch(setIdToSet[n].cluster){case 0:c+="recommended by "+i[0].trim();break;case 1:c+="bookmarked by "+i[0].trim();break;case 2:c+="tagged with "+i[0].trim()}$("#element-view-description").text("All papers "+c+".").css("color",selections.getColor(r)),document.getElementById("tipbar").innerHTML="Showing all papers "+c+" on the right side."}).style({cursor:"s-resize"})}function s(){}function c(){e(),$("#set-vis-container")[0].getBoundingClientRect().width-ctx.xStartSetSizes-45<450&&(ctx.subSetSizeWidth=$("#set-vis-container")[0].getBoundingClientRect().width-ctx.xStartSetSizes-45);var t=!1,a=ctx.svgHeader.selectAll(".tableHeaderGroup").data([1]),s=a.enter().append("g").attr({"class":"tableHeaderGroup noselect"});ctx.subSetSizeWidth<450&&null==s[0][0]&&(ctx.svgHeader.selectAll(".tableHeaderGroup").remove(),a=ctx.svgHeader.selectAll(".tableHeaderGroup").data([1]),s=a.enter().append("g").attr({"class":"tableHeaderGroup noselect"}),t=!0),r(ctx.svgHeader);var i=s.append("g").attr({id:"subSetSizeAxis","class":"axis"});i.each(function(){ctx.brushableScaleSubsetUpdate=function(){},ctx.brushableScaleSubset=new BrushableScale(ctx,d3.select(this),ctx.subSetSizeWidth,"brushableScaleSubsetUpdate","plotTable","subSetSizeScale",{columnLabel:"Number of papers"})});var c=d3.max(ctx.globalStatistics,function(e){return e.value});a.selectAll("#subSetSizeAxis").attr({transform:"translate("+ctx.xStartSetSizes+","+(ctx.textHeight+5+ctx.guildHeaderHeight)+")"}).call(ctx.brushableScaleSubsetUpdate,{maxValue:c,labels:ctx.globalStatistics}),n(ctx.tableHeaderNode),ctx.subSetSizeWidth=$("#subSetSizeAxis")[0].getBoundingClientRect().width,ctx.svgHeader.attr("width",ctx.w)}function l(){var e=ctx.gRows.selectAll(".row").data(renderRows,function(e,t){return e.id}),t=e.enter().append("g").attr({transform:function(e){if(e.data.type===ROW_TYPE.SUBSET||e.data.type===ROW_TYPE.GROUP)return"translate(0, "+ctx.rowScale(e.id)+")";var t=ctx.textHeight;return 2==e.data.level&&(t+=10),"translate(0, "+t+")"},"class":function(e){return"row "+e.data.type}}).style("opacity",function(e){return e.data.type===ROW_TYPE.SUBSET||e.data.type===ROW_TYPE.GROUP?0==ctx.gRows.selectAll(".row")[0].length?1:0:ctx.gRows.selectAll(".row")[0].length?0:1}).on({mouseenter:function(e,t){var a=e.data.elementName.split(",");if(1==a.length)if(""==a[0])document.getElementById("tipbar").innerHTML="Click to view papers related to none of the selected sets on the right side.";else{var r=setIdToSet[a[0]].elementName.split(/\(|\)/g);document.getElementById("tipbar").innerHTML="Click to view papers only related to "+r[0].trim()+" on the right side."}else{var n=e.data.elementName.split(","),s="",i="",c="";n.forEach(function(e){var t=setIdToSet[e].elementName.split(/\(|\)/g);switch(setIdToSet[e].cluster){case 0:s+=t[0].trim()+", ";break;case 1:i+=t[0].trim()+", ";break;case 2:c+=t[0].trim()+", "}}),descriptionText="Click to view papers ",""!=s&&(descriptionText+="recommended by "+s),""!=i&&(descriptionText+="bookmarked by "+i),""!=c&&(descriptionText+="tagged with "+c),usedSets.length>n.length?descriptionText+="but not related to the rest of the selected sets.":(descriptionText=descriptionText.slice(0,-2),descriptionText+="."),document.getElementById("tipbar").innerHTML=descriptionText}mouseoverRow(e,t)},mouseleave:function(e,t){document.getElementById("tipbar").innerHTML="",mouseoutRow(e)},click:function(e){(e.data.type===ROW_TYPE.SUBSET||e.data.type===ROW_TYPE.GROUP)&&d3.mouse(this)[0]>0&&d3.mouse(this)[0]<ctx.xStartSetSizes+ctx.subSetSizeWidth&&ctx.intersectionClicked(e)}});t.append("g").attr("class","gBackgroundRect"),t.append("g").attr("class","gHorizon"),t.append("g").attr("class","gOverlays"),t.append("g").attr("class","gIndicators"),e.exit().remove();var a=e;return ctx.rowTransitions&&usedSets.length<10&&(a=e.transition().duration(function(e,t){return e.data.type===ROW_TYPE.SUBSET?queryParameters.duration:queryParameters.duration})),a.attr({transform:function(e){return"translate(0, "+ctx.rowScale(e.id)+")"},"class":function(e){return"row "+e.data.type}}).transition().duration(100).style("opacity",1),e}function o(e,t){var a=e.select(".gBackgroundRect").selectAll(".backgroundRect").data(function(e){return[e]});a.enter().append("rect").attr({"class":"backgroundRect",x:0,y:0,width:ctx.setVisWidth,height:ctx.cellSize}).style({"fill-opacity":1e-4,fill:ctx.backHighlightColor}),a.exit().remove(),a.attr({width:ctx.setVisWidth,height:ctx.cellSize});var r=e.selectAll("g.combination").data(function(e){return[e.data.combinedSets]});r.enter().append("g").attr({"class":"combination"}),r.exit().remove();var n=r.selectAll(".cell").data(function(e){return e.map(function(e,t){return{data:usedSets[t],value:e}})});n.enter().append("circle").on({click:function(e){}}),n.exit().remove(),n.attr("cx",function(e,t){return ctx.cellWidth*t+ctx.cellWidth/2}).attr({r:ctx.cellSize/2-2,cy:ctx.cellSize/2,"class":"cell"}).style("fill",function(e){return 1==e.value&&e.data.id==globalSetId?"#6fadfd":t(e.value)}).style("stroke",function(e){return e.data.id==globalSetId?"#6fadfd":"#636363"}).attr({"stroke-width":"2pt"});r.selectAll(".cellConnector").data(function(e){var t=d3.extent(e.map(function(e,t){return 1==e?t:-1}).filter(function(e,t){return e>=0}));return t[0]==t[1]?[]:[t]});e.each(function(e,t){var a=d3.select(this),r=ctx.subSetSizeScale.domain()[1],n=0,s=1,i=d3.range(s).map(function(){var t={};return t.data={},t.data.type=e.data.type,1==s&&e.data.setSize>0&&e.data.setSize%r==0?(t.data.setSize=e.data.setSize,t):(n==s-1&&Math.ceil(e.data.setSize/r)<s+1?t.data.setSize=e.data.setSize%r:t.data.setSize=r,n++,t)});if(a.selectAll(".cutlines").remove(),Math.ceil(e.data.setSize/r)>ctx.maxLevels){var c=a.selectAll(".cutlines").data([e.id]).enter().append("g").attr("class","cutlines");c.append("line").attr({x1:ctx.xStartSetSizes+ctx.subSetSizeWidth-30,x2:ctx.xStartSetSizes+ctx.subSetSizeWidth-20,y1:0,y2:30}).style({stroke:"white","stroke-width":1}),c.append("line").attr({x1:ctx.xStartSetSizes+ctx.subSetSizeWidth-35,x2:ctx.xStartSetSizes+ctx.subSetSizeWidth-25,y1:0,y2:30}).style({stroke:"white","stroke-width":1})}var l=a.selectAll(".gHorizon").selectAll(".row-type-subset").data(i).enter();l.append("rect").attr("class",function(e){return"subSetSize row-type-subset"}),a.selectAll(".row-type-subset").data(i).exit().remove(),a.selectAll(".row-type-subset").attr({transform:function(e,t){var a=0;return e.data.type!==ROW_TYPE.SUBSET&&(a=0),"translate("+ctx.xStartSetSizes+", "+(a+ctx.cellSizeShrink*t+1)+")"},width:function(e,t){return ctx.subSetSizeScale(e.data.setSize)},height:function(e,t){return ctx.cellSize-2*ctx.cellSizeShrink*t-2}}).style({fill:function(e,t){return ctx.horizonBarGrays(t)}})})}function d(e){function t(){var t=e.filter(function(e){return"combinedSets"in e.data}),a=t.selectAll("g.combination").data(function(e){return[e.data.combinedSets]});a.enter().append("g").attr({"class":"combination"}),a.exit().remove();var r=a.selectAll(".cell").data(function(e){return e.map(function(e,t){return{data:usedSets[t],value:e}})});r.enter().append("circle"),r.exit().remove(),r.attr("cx",function(e,t){return ctx.cellWidth*t+ctx.cellWidth/2}).attr({r:ctx.cellSize/2-3,cy:ctx.cellSize/2,"class":"cell"}).style("fill",function(e){switch(e.value){case 0:return ctx.grays[0];case 1:return ctx.grays[1];default:return"url(#DontCarePattern)"}}).style({stroke:function(e){return 0==e.value?ctx.grays[1]:"none"}})}function a(){var t=e.filter(function(e){return"orClauses"in e.data&&e.data.orClauses.length>1}),a=t.selectAll("g.complexCombination").data(function(e){return[e.data.orClauses]});a.enter().append("g").attr({"class":"complexCombination"}),a.exit().remove(),a.selectAll("text").data(function(e){return[e]}).enter().append("text").attr({"class":function(){return ctx.cellDistance<14?"groupLabel small":"groupLabel"},x:usedSets.length*ctx.cellWidth*.5,y:ctx.cellWidth-3}).style({cursor:"pointer","text-anchor":"middle"}).text(function(e){return"combination"}).on({mouseover:function(e){var t=d3.select(this.parentNode.parentNode).attr("transform").split(/[,()]/);if(4==t.length){var a=ctx.toolTipLayer.append("g").attr({"class":"toolTipQuery",transform:"translate("+(+t[1]+ctx.leftOffset-5)+","+(+t[2]+ctx.cellSize+5)+")"});a.style({opacity:1e-5}).transition().style({opacity:1}),a.append("rect").attr({width:usedSets.length*ctx.cellWidth+10,height:e.length*ctx.cellSize+10,rx:10,ry:10}).style({"stroke-width":2,stroke:ctx.grays[1],fill:ctx.grays[0]}),e.forEach(function(e,t){var r=t*ctx.cellSize,n=a.append("g").attr({"class":"combination",transform:"translate(0,"+r+")"});n.selectAll(".cell").data(function(t){return Object.keys(e).map(function(t){return e[t]})}).enter().append("circle").attr("cx",function(e,t){return ctx.cellWidth*t+ctx.cellWidth/2+5}).attr({r:ctx.cellSize/2-3,cy:ctx.cellSize/2+5,"class":"cell"}).style("fill",function(e){switch(e.state){case 0:return ctx.grays[0];case 1:return ctx.grays[1];default:return"url(#DontCarePattern)"}}).style({stroke:function(e){return 0==e.value?ctx.grays[1]:"none"}})})}},mouseout:function(){ctx.toolTipLayer.selectAll(".toolTipQuery").transition().attr({opacity:1e-4}).remove()}})}var r=e.select(".gBackgroundRect").selectAll(".groupBackGround").data(function(e){return[e]});r.enter().append("rect").attr({"class":function(e){return e.data instanceof QueryGroup?"groupBackGround filterGroup":e.data.level>1?"groupBackGround secondLevel":"groupBackGround"},rx:5,ry:10,width:ctx.setVisWidth+ctx.leftOffset,height:ctx.cellSize,x:-ctx.leftOffset,y:0}),r.exit().remove(),r.attr({width:function(e){return ctx.setVisWidth+ctx.leftOffset-(e.data.level-1)*ctx.leftIndent},height:ctx.cellSize,x:function(e){return(e.data.level-1)*ctx.leftIndent-ctx.leftOffset}});var n=e.selectAll(".groupLabel.groupLabelText").data(function(e){return[e]});n.enter().append("text").attr({"class":"groupLabel groupLabelText",y:ctx.cellSize-3,x:function(e){return-ctx.leftOffset+12+(e.data.level-1)*ctx.leftIndent},"font-size":ctx.cellSize-6}),n.exit().remove();n.text(function(e){if(e.data.type===ROW_TYPE.AGGREGATE)return String.fromCharCode(8709)+"-subsets ("+e.data.subSets.length+") ";var t=0;t=e.data.type===ROW_TYPE.GROUP&&"undefined"!=typeof e.data.combinedSets?10:ctx.truncateGroupAfter;var a=e.data.elementName.substring(0,t);return a.length<e.data.elementName.length&&(a=a.trim()+"..."),a}).attr({"class":function(){return ctx.cellDistance<14?"groupLabel groupLabelText small":"groupLabel groupLabelText"},y:ctx.cellSize-3,x:function(e){return-ctx.leftOffset+15+(e.data.level-1)*ctx.leftIndent}}).on("click",function(e){UpSetState.forceUpdate=!0,collapseGroup(e.data),s(),b(!1)}).append("svg:title").text(function(e,t){return e.data.elementName}).style({"font-size":"16pt"});var i=e.selectAll(".collapseIcon").data(function(e){return[e]});i.enter().append("text").attr({"class":"collapseIcon"}).on("click",function(e){UpSetState.forceUpdate=!0,collapseGroup(e.data),s(),b(!1)}),i.text(function(e){return 0==e.data.isCollapsed?"":""}).attr({transform:function(e){return"translate("+(-ctx.leftOffset+2+5+(e.data.level-1)*ctx.leftIndent)+","+(ctx.cellSize/2+5)+")"}}).style({"font-size":"16pt"});var c=e.filter(function(e){return e.data instanceof QueryGroup}),l=c.selectAll(".groupDeleteIcon").data(function(e){return[e]}),o=l.enter().append("g").attr({"class":"groupDeleteIcon"});o.append("text").text("").on({click:function(e){var t=-1;UpSetState.logicGroups.forEach(function(a,r){a.id==e.id&&(t=r)}),UpSetState.logicGroups.splice(t,1),UpSetState.logicGroupChanged=!0,UpSetState.forceUpdate=!0,updateState(),b()}}).style({fill:"#f46d43"}),l.attr({transform:"translate("+(ctx.xStartSetSizes-12)+","+(ctx.cellSize/2+4)+")"}),t(),a(),e.each(function(e,t){var a=d3.select(this),r=ctx.subSetSizeScale.domain()[1],n=0,s=1,i=d3.range(s).map(function(){var t={};return t.data={},t.data.type=e.data.type,1==s&&e.data.setSize>0&&e.data.setSize%r==0?(t.data.setSize=e.data.setSize,t):(n==s-1&&Math.ceil(e.data.setSize/r)<s+1?t.data.setSize=e.data.setSize%r:t.data.setSize=r,n++,t)});if(a.selectAll(".cutlines").remove(),Math.ceil(e.data.setSize/r)>ctx.maxLevels){var c=a.selectAll(".cutlines").data([e.id]).enter().append("g").attr("class","cutlines");c.append("line").attr({x1:ctx.xStartSetSizes+ctx.subSetSizeWidth-30,x2:ctx.xStartSetSizes+ctx.subSetSizeWidth-20,y1:0,y2:30}).style({stroke:"white","stroke-width":1}),c.append("line").attr({x1:ctx.xStartSetSizes+ctx.subSetSizeWidth-35,x2:ctx.xStartSetSizes+ctx.subSetSizeWidth-25,y1:0,y2:30}).style({stroke:"white","stroke-width":1})}var l=a.select(".gHorizon").selectAll(".row-type-group").data(i).enter();l.append("rect").attr("class",function(e){return"subSetSize row-type-group"}),a.selectAll(".row-type-group").data(i).exit().remove(),a.selectAll(".row-type-group").attr({transform:function(e,t){return"translate("+ctx.xStartSetSizes+", "+(ctx.cellSizeShrink*t+2)+")"},width:function(e,t){return ctx.subSetSizeScale(e.data.setSize)},height:function(e,t){return ctx.cellSize-4-2*ctx.cellSizeShrink*t}}).style({fill:function(e,t){return ctx.horizonBarGrays(t)}}).on("click",function(e){})})}function u(e){if(0==selections.getSize())return e.selectAll(".what").remove(),e.selectAll(".newOverlay").remove(),void e.selectAll(".selectionIndicators").remove();var t=0;e.selectAll(".what").remove(),e.selectAll(".newOverlay").remove(),e.selectAll(".selectionIndicators").remove(),e.each(function(e,a){var r=d3.select(this),n=ctx.subSetSizeScale.domain()[1];e.data.type==ROW_TYPE.GROUP&&(e.data.selections={},e.data.selections.setSize=e.data.setSize,t=e.data.setSize,e.data.subSets.map(function(t,a){"undefined"==typeof e.data.selections&&(e.data.selections={});for(var r in t.selections)"undefined"==typeof e.data.selections[r]&&(e.data.selections[r]=[]),e.data.selections[r]=e.data.selections[r].concat(t.selections[r])}));var s=!1,i=Object.getOwnPropertyNames(e.data.selections),c=e.data.selections;if(i.forEach(function(e){c[e].length;selections.isActiveByUuid(e)&&(s=e)}),!s)return 0;t=c[s].length,e.data.type==ROW_TYPE.GROUP&&(e.data.selections.setSize=t);var l=0,o=1,d=d3.range(o).map(function(){var a={};return a.data={},a.data.setSize=t,a.data.type=e.data.type,1==o&&t>0&&t%n==0?(a.data.setSize=t,a):(l==o-1&&Math.ceil(t/n)<o+1?a.data.setSize=t%n:a.data.setSize=n,l++,a)}),u=r.selectAll(".gOverlays").selectAll(".newOverlay").data(d).enter();u.append("rect").attr("class","newOverlay"),r.selectAll(".newOverlay").data(d).exit().remove(),r.selectAll(".newOverlay").attr({transform:function(e,t){return"translate("+ctx.xStartSetSizes+", "+(ctx.cellSizeShrink*t+1)+")"},width:function(e,t){return ctx.subSetSizeScale(e.data.setSize)},height:function(e,t){return ctx.cellSize-2*ctx.cellSizeShrink*t-2},fill:function(t){var a=!1,r=Object.getOwnPropertyNames(e.data.selections),n=e.data.selections;return r.forEach(function(e){n[e].length;selections.isActiveByUuid(e)&&(a=e)}),a?selections.getColorFromUuid(a):0}}).style("opacity",function(e,t){return 1==o?1:2==o?.5+.2*t:.2+.3*t})})}function p(e){var t=e.selectAll(".intersectionSizeLabel").data(function(e){return[e]});t.enter().append("text").attr({"class":"intersectionSizeText intersectionSizeLabel noselect"}),t.exit().remove();var a=t.text(function(e){return e.data.setSize});ctx.barTransitions&&a.transition(),a.attr({"class":"intersectionSizeText intersectionSizeLabel noselect",y:ctx.cellSize/2,x:function(e){return ctx.xStartSetSizes+ctx.subSetSizeScale(e.data.setSize)+2}})}function S(){var e=ctx.columnBackgroundNode.selectAll(".columnBackground").data(usedSets);e.enter().append("rect").attr({"class":"columnBackground"}).style({stroke:"none",fill:ctx.backHighlightColor,opacity:0}),e.exit().remove(),e.attr({x:function(e,t){return ctx.cellWidth*t},height:ctx.svgHeight,width:ctx.cellWidth})}function g(){S();var e=null,t=l().filter(function(t){return t.data.type==ROW_TYPE.SEPARATOR?(e=d3.select(this),!1):!0}),a=d3.scale.ordinal().domain([0,1]).range(ctx.grays),r=t.filter(function(e){return e.data.type===ROW_TYPE.SUBSET});o(r,a);var n=t.filter(function(e,t){return e.data.type===ROW_TYPE.GROUP||e.data.type===ROW_TYPE.AGGREGATE?!0:!1});if(d(n),p(t),u(t),null!=e){var s=e.selectAll(".gSeparatorLine").data([1]);s.enter().append("line").attr({"class":"gSeparatorLine"}),s.attr({x1:-ctx.leftOffset,x2:ctx.w,y1:ctx.cellSize/2,y2:ctx.cellSize/2})}d3.selectAll(".setSizeBackground").each(function(e,t){e.elementName==ctx.newlyAddedSet&&(mouseoverColumn(e,t),ctx.newlyAddedSet="")}),d3.select(".divForeign").select("svg").attr("height",renderRows.length*ctx.cellDistance)}function m(){$(EventManager).bind("item-selection-added",function(e,t){t.selection.mapToSubsets(subSets),plotSelectionTabs("#selection-tabs",selections,t.selection),plotSelectedItems("#item-table",t.selection),elementViewers.renderViewer()}),$(EventManager).bind("item-selection-updated",function(e,t){t.selection.mapToSubsets(subSets),plot(),plotSelectionTabs("#selection-tabs",selections,t.selection),plotSelectedItems("#item-table",t.selection),elementViewers.renderViewer(),plotSetOverview()}),$(EventManager).bind("item-selection-activated",function(e,t){t.selection?(plot(),plotSelectionTabs("#selection-tabs",selections,t.selection),t.selection.filterCollection.renderFilters(),plotSelectedItems("#item-table",t.selection),plotSetOverview()):(plot(),plotSelectionTabs("#selection-tabs",selections,t.selection),plotSelectedItems("#item-table",t.selection)),elementViewers.renderViewer()}),$(EventManager).bind("loading-dataset-started",function(e,t){$(".ui-fader").show(),$("#data-loading-indicator").show()}),$(EventManager).bind("loading-dataset-finished",function(e,t){$(".ui-fader").fadeOut(1e3),$("#data-loading-indicator").fadeOut(1e3),elementViewers.renderController(),elementViewers.renderViewer()}),$(EventManager).bind("set-added",function(e,t){ctx.newlyAddedSet=t.set.elementName}),$(EventManager).bind("set-removed",function(e,t){}),$(EventManager).bind("refresh",function(e,t){var a=attributes[0].values[t];for(i=0;i<dataForVis.UserAndBookmarks.length;i++)if(dataForVis.UserAndBookmarks[i].bookmarks.indexOf(a)>-1){var r=dataForVis.UserAndBookmarks[i].setID,n=setIdToSet[r].elementName.split(/\(|\)|\//g);n[1]=++dataForVis.commonCount[dataForVis.UserAndBookmarks[i].userID];var s=" "+n[0]+" ("+n[1]+"/"+n[2]+")";$('label[for="input'+r+'"]').text(s),0!=$('text[id="'+r+'"]').length&&d3.select("#"+r).text(s).append("svg:title").text(function(e,t){if(e.id==globalSetId)return"Papers bookmarked by you.";switch(e.cluster){case 1:return parseInt(n[2].trim())>1?n[2].trim()+" papers bookmarked by "+n[0].trim()+".":n[2].trim()+" paper bookmarked by "+n[0].trim()+"."}return""}),setIdToSet[r].elementName=s}var c=setIdToSet[globalSetId].elementName.split(/\(|\)|\//g),l=" "+c[0]+"("+(parseInt(c[1],10)+1)+"/"+(parseInt(c[2],10)+1)+")";d3.select("#"+globalSetId).text(l).append("svg:title").text("Papers bookmarked by you."),setIdToSet[globalSetId].itemList[t]=1,setIdToSet[globalSetId].elementName=l,setIdToSet[globalSetId].items.push(t),setIdToSet[globalSetId].setSize++,$('label[for="input'+globalSetId+'"]').text(l),x(),attributes[attributes.length-1].values[t].push(globalSetId),subSets.length=0,dataRows.length=0,setUpSubSets(),previousState=void 0,updateState(),plotSetOverview(),initCallback.forEach(function(e){e()})}),$(EventManager).bind("vis-svg-resize",function(e,t){h(null,t.newWidth),c(),g(),plotSetOverview()})}function x(){var e=$("ul#1>li");e.sort(function(e,t){var a=$("label",e).text().split(/\(|\)|\//g),r=$("label",t).text().split(/\(|\)|\//g);return parseInt(a[1])>parseInt(r[1])?-1:a[1]==r[1]&&parseInt(a[2])>parseInt(r[2])?-1:1}),$("ul#1").empty().html(e)}function f(){d3.selectAll("#sortNrSetsInIntersectionAscend").on("click",function(e){ctx.sortCheck="sortNrSetsInIntersectionAscend",UpSetState.sorting=StateOpt.sortByCombinationSizeAscend;var t=new Date;userBehavior.push({type:2,sort:[{name:"sort by overlapping sizes Ascending",type:6}],time:(t.getDate()<10?"0":"")+t.getDate()+" @ "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()}),UpSetState.forceUpdate=!0,updateState(),b(),document.getElementById("tipbar").innerHTML="Sort rows by the number of attended sets (ascending)."}),d3.selectAll("#sortNrSetsInIntersectionDescend").on("click",function(e){ctx.sortCheck="sortNrSetsInIntersectionDescend",UpSetState.sorting=StateOpt.sortByCombinationSizeDescend;var t=new Date;userBehavior.push({type:2,sort:[{name:"sort by overlapping sizes Descending",type:7}],time:(t.getDate()<10?"0":"")+t.getDate()+" @ "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()}),UpSetState.forceUpdate=!0,updateState(),b(),document.getElementById("tipbar").innerHTML="Sort rows by the number of attended sets (descending)."}),d3.selectAll("#sortIntersectionSize").on("click",function(e){ctx.sortCheck="sortIntersectionSize",UpSetState.sorting=StateOpt.sortBySubSetSize;var t=new Date;userBehavior.push({type:2,sort:[{name:"sort by set sizes Descending",type:9}],time:(t.getDate()<10?"0":"")+t.getDate()+" @ "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()
}),UpSetState.forceUpdate=!0,updateState(),b(),document.getElementById("tipbar").innerHTML="Sort rows by their related number of papers (largest to smallest)."}),d3.selectAll("#sortIntersectionSizeAscend").on("click",function(e){ctx.sortCheck="sortIntersectionSizeAscend",UpSetState.sorting=StateOpt.sortBySubSetSizeAscend;var t=new Date;userBehavior.push({type:2,sort:[{name:"sort by set sizes Ascending",type:8}],time:(t.getDate()<10?"0":"")+t.getDate()+" @ "+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()}),UpSetState.forceUpdate=!0,updateState(),b(),document.getElementById("tipbar").innerHTML="Sort rows by their related number of papers (smallest to largest)."})}function h(e,t){if(null==t);else if(null==e){ctx.svgBody.attr({width:Math.max(ctx.w,500)}),ctx.svgHeader.attr({});var a=ctx.cellWidth*usedSets.length+ctx.majorPadding+ctx.subSetSizeWidthMax+50;ctx.subSetSizeWidth=d3.scale.linear().domain([a,a-(ctx.subSetSizeWidthMax-100)]).range([ctx.subSetSizeWidthMax,100]).clamp(!0)(t),ctx.brushableScaleSubsetUpdate(null,{width:ctx.subSetSizeWidth})}}m();var b=function(e){null!=e?ctx.rowTransitions=e:ctx.rowTransitions=!0,c(),g(),ctx.rowTransitions=!0};ctx.updateColumnBackgrounds=S,ctx.plot=b,ctx.plotTable=function(){ctx.barTransitions=!1,g(),ctx.barTransitions=!0},f(),initData(ctx,[t])}var ctx={majorPadding:25,minorPadding:2,cellDistance:27,textHeight:130,textSpacing:25,setSizeWidth:700,subSetSizeWidth:450,subSetSizeWidthMax:450,leftOffset:130,leftIndent:10,topOffset:200,cellSizeShrink:3,maxLevels:1,expectedValueWidth:0,expectedValueWidthMax:0,labelTopPadding:42,paddingTop:30,paddingSide:20,truncateAfter:25,truncateGroupAfter:25,setCellDistance:12,setCellSize:10,cellWidth:27,svgHeight:1200,guildHeaderHeight:60,grays:["#f0f0f0","#636363"],backHighlightColor:"#fed9a6",specialHighlightColor:"#f4fd6f",rowTransitions:!0,barTransitions:!0,globalStatistics:[{name:"largest intersection",id:"I",value:100},{name:"largest aggregate",id:"A",value:120},{name:"largest set",id:"S",value:150},{name:"universal set",id:"U",value:200}],nameForRelevance:"Disproportionality",summaryStatisticVis:[{attribute:"",visObject:{}}],summaryStatisticsWidth:100,groupingOptions:{},setSelection:{paginationStart:0,paginationEnd:10,mode:"none",modeChange:!1,multiSelIn:d3.set(),multiSelOut:d3.set(),setOrder:"size"},logicStates:{NOT:0,DONTCARE:2,MUST:1},w:0,tableBodyHeight:0,rowScale:0,cellSize:0,xStartSetSizes:0,setVisWidth:0,xStartStatisticColumns:0,newlyAddedSet:"",scaleBarEndRange:20,sortCheck:"sortIntersectionSizeAscend"};