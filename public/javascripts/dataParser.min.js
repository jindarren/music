function dataParser(e){function t(){var t=$(h),n=$(g),o=$(f),s=[],r=[],c=[],a=[],l={},u=[],x=[],C=[],S=[],N=[],T=[],R={},J=0;t.find("RECORD").each(function(){var e,t,n,o;e=$(this).find("contentID").text(),n=$(this).find("title").text(),t=$(this).find("presentationID").text(),o=$(this).find("author_list").text(),s.push({contentID:e,presentationID:t,title:n,authors:o}),J++});var U=[];if(-1==U.indexOf(D)){r.push({userID:D,userName:b}),U.push(D);var A=[];y.UserAndBookmarks.push({userID:D,userName:b,setID:"",bookmarks:A}),R[D]=0,y.commonCount[D]=0}for(n.find("RECORD").each(function(){var e=$(this).find("contentID").text(),t=$(this).find("userID").text(),n=$(this).find("strUserID").text();if(-1==U.indexOf(t)){r.push({userID:t,userName:n}),U.push(t);var o=[];o.push(e),y.UserAndBookmarks.push({userID:t,userName:n,setID:"",bookmarks:o}),R[t]=1,y.commonCount[t]=0}else{R[t]++;for(var s=0;s<y.UserAndBookmarks.length&&y.UserAndBookmarks[s].userID!=t;s++);y.UserAndBookmarks[s].bookmarks.push(e)}t==D&&y.currentUserBookmarks.push(e);for(var i=0;i<c.length&&c[i].contentID!=e;i++);if(i<c.length)c[i].userIDList.push(t);else{var a=[];a.push(t),c.push({userIDList:a,contentID:e})}}),k=0;k<y.UserAndBookmarks.length;k++){var B=0,P=y.UserAndBookmarks[k].bookmarks;for(m=0;m<P.length;m++)y.currentUserBookmarks.indexOf(P[m])>-1&&B++;y.commonCount[y.UserAndBookmarks[k].userID]=B}Array.prototype.unique=function(){var e,t={},n=this.length,o=[];for(e=0;n>e;e+=1)t[this[e]]=this[e];for(e in t)o.push(t[e]);return o},o.find("RECORD").each(function(){var e=$(this).find("contentID").text(),t=$(this).find("tag_list").text(),n=t.split("|");for(i=0;i<n.length;i++)n[i]=n[i].replace(/(\r\n|\n|\r)/gm,""),n[i]=n[i].trim();n=n.unique();var o;for(o=0;o<u.length&&u[o].contentID!=e;o++);if(o<u.length)for(i=0;i<n.length;i++)u[o].tags.indexOf(n[i])<0&&(u[o].tags.push(n[i]),l.hasOwnProperty(n[i])?l[n[i]]++:(a.push(n[i]),l[n[i]]=1));else{for(i=0;i<n.length;i++)l.hasOwnProperty(n[i])?l[n[i]]++:(l[n[i]]=1,a.push(n[i]));u.push({contentID:e,tags:n})}}),a.sort();try{var q=p.Results.Items[0].Item;for(i=0;i<q.length;i++)x.push(q[i].contentID[0])}catch(E){console.log("get content based recommendations failed."+E)}try{for(q=d.Results.Items[0].Item,i=0;i<q.length;i++)C.push(q[i].contentID[0])}catch(E){console.log("get tag based recommendations failed."+E)}try{for(q=I.Results.Items[0].Item,i=0;i<q.length;i++)T.push(q[i].contentID[0])}catch(E){console.log("get top recommendations failed."+E)}try{for(q=v.Results.Items[0].Item,i=0;i<q.length;i++)S.push(q[i].contentID[0])}catch(E){console.log("get bibli recommendations failed."+E)}try{for(q=O.Results.Items[0].Item,i=0;i<q.length;i++)N.push(q[i].contentID[0])}catch(E){console.log("get external recommendations failed."+E)}r.sort(function(e,t){return y.commonCount[t.userID]==y.commonCount[e.userID]?R[t.userID]-R[e.userID]:y.commonCount[t.userID]-y.commonCount[e.userID]});var w=0;y.csvContent+="name;presentationID;title;authors;",T.length>0&&(y.csvContent+="top-10 agent ("+T.length+");",w++),C.length>0&&(y.csvContent+="tag-based agent ("+C.length+");",w++),x.length>0&&(y.csvContent+="bookmark-based agent ("+x.length+");",w++),S.length>0&&(y.csvContent+="bibliography agent ("+S.length+");",w++),N.length>0&&(y.csvContent+="ext. bookmarks agent ("+N.length+");",w++);var L=[],_=3+w;for(y.JSONObject.name="IUI2016 Exploration",y.JSONObject.header=0,y.JSONObject.separator=";",y.JSONObject.skip=0,y.JSONObject.meta=[],y.JSONObject.meta.push({type:"id",index:0,name:"name"}),y.JSONObject.meta.push({type:"string",index:1,name:"presentationID"}),y.JSONObject.meta.push({type:"string",index:2,name:"Title"}),y.JSONObject.meta.push({type:"authorString",index:3,name:"Authors"}),y.JSONObject.sets=[],y.JSONObject.sets.push({name:"Agents (number of papers)",format:"binary",start:4,end:_}),w=_+1,i=0;i<r.length;i++)L.push(r[i].userID),y.csvContent+=r[i].userName+" ("+y.commonCount[r[i].userID]+"/"+R[r[i].userID]+");",_++;for(y.JSONObject.sets.push({name:"Users (common bookmarks/total bookmarks)",format:"binary",start:w,end:_}),w=_+1,i=0;i<a.length;i++)y.csvContent+=a[i]+" ("+l[a[i]]+");",_++;for(y.JSONObject.sets.push({name:"Tags (number of related papers)",format:"binary",start:w,end:_}),y.csvContent+="\n",i=0;i<s.length;i++){var Q=s[i].contentID;y.csvContent+=s[i].contentID+";",y.csvContent+=s[i].presentationID+";",y.csvContent+=s[i].title+";",y.csvContent+=s[i].authors+";",T.length>0&&(T.indexOf(Q)>-1?y.csvContent+="1;":y.csvContent+="0;"),C.length>0&&(C.indexOf(Q)>-1?y.csvContent+="1;":y.csvContent+="0;"),x.length>0&&(x.indexOf(Q)>-1?y.csvContent+="1;":y.csvContent+="0;"),S.length>0&&(S.indexOf(Q)>-1?y.csvContent+="1;":y.csvContent+="0;"),N.length>0&&(N.indexOf(Q)>-1?y.csvContent+="1;":y.csvContent+="0;");var z=$.grep(c,function(e){return e.contentID==Q});if(0==z.length)for(console.log(Q+"has no bookmarks"),j=0;j<L.length;j++)y.csvContent+="0;";else{var F=z[0].userIDList;for(j=0;j<L.length;j++)F.indexOf(L[j])>-1?y.csvContent+="1;":y.csvContent+="0;"}if(z=$.grep(u,function(e){return e.contentID==Q}),0==z.length)for(console.log(Q+"has no tag"),j=0;j<a.length;j++)y.csvContent+="0;";else{var G=z[0].tags;for(j=0;j<a.length;j++)G.indexOf(a[j])>-1?y.csvContent+="1;":y.csvContent+="0;"}y.csvContent+="\n"}e()}function n(){A++,5>A?paperRequest=$.ajax({type:"POST",url:"proceedings",contentType:"text/xml",success:function(e){try{h=e}catch(t){console.log("proceedings error")}o()},error:function(){console.log("get paper list failed."),n()},timeout:5e3}).complete(R.resolve):o()}function o(){P++,5>E?bookmarkRequest=$.ajax({type:"POST",url:"bookmarks",contentType:"text/xml",success:function(e){try{g=e}catch(t){console.log(t)}s()},error:function(){console.log("get bookmark failed."),o()},timeout:5e3}).complete(C.resolve):s()}function s(){B++,5>B?tagRequest=$.ajax({type:"POST",url:"tags",contentType:"text/xml",success:function(e){try{f=e}catch(t){console.log("tag error")}r()},error:function(){console.log("get tag failed."),s()},timeout:5e3}).complete(T.resolve):r()}function r(){L++,5>L?topRec=$.ajax({type:"POST",url:"top",contentType:"application/json",success:function(e){try{I=e}catch(t){console.log("top rec error")}c()},error:function(){console.log("get top rec failed."),r()},timeout:5e3}).complete(U.resolve):c()}function c(){q++,5>q?tagRecRequest=$.ajax({type:"POST",url:"tagbased",data:JSON.stringify({userid:D}),dataType:"json",contentType:"application/json",success:function(e){try{d=e}catch(t){console.log("rec error")}a()},error:function(){console.log("get tag rec failed."),c()},timeout:5e3}).complete(N.resolve):a()}function a(){E++,5>E?contentRecRequest=$.ajax({type:"POST",url:"contentbased",data:JSON.stringify({userid:D}),dataType:"json",contentType:"application/json",success:function(e){try{p=e}catch(t){console.log("rec error")}l()},error:function(){console.log("get bookmark rec failed."),a()},timeout:5e3}).complete(S.resolve):l()}function l(){_++,5>_?externalRec=$.ajax({type:"POST",url:"external",data:JSON.stringify({userid:D}),dataType:"json",contentType:"application/json",success:function(e){try{O=e}catch(t){console.log("external rec error")}u()},error:function(){console.log("get ext failed."),l()},timeout:5e3}).complete(J.resolve):u()}function u(){w++,5>w?bibliRec=$.ajax({type:"POST",url:"bibli",data:JSON.stringify({userid:D}),dataType:"json",contentType:"application/json",success:function(e){try{v=e}catch(n){console.log("bibli error")}t()},error:function(){console.log("get bibli failed."),u()},timeout:5e3}).complete(x.resolve):t()}this.JSONObject=new Object,this.csvContent="",this.currentUserBookmarks=[],this.UserAndBookmarks=[],this.commonCount={};var h,g,f,p,d,v,I,O,D=globalUserId.toString(),b=globalname.toString(),y=this,x=$.Deferred(),C=$.Deferred(),S=$.Deferred(),N=$.Deferred(),T=$.Deferred(),R=$.Deferred(),J=$.Deferred(),U=$.Deferred();jQuery.support.cors=!0;var A=0,B=0,P=0,q=0,E=0,w=0,L=0,_=0;n()}